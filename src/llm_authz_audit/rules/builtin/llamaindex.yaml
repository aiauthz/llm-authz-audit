rules:
  - id: TR003
    title: "LlamaIndex FunctionTool without permission checks"
    severity: high
    pattern: 'FunctionTool\.from_defaults'
    file_types: ["*.py"]
    suppress_if: ['permission', 'authorize', 'auth_check', 'rbac', 'role_check', 'allowed_tools']
    owasp_llm: "LLM06"
    remediation: "Implement tool-level RBAC before registering tools with agents."
    description: "LlamaIndex tool created without access control or permission checks."
    analyzer: "ToolRBACAnalyzer"

  - id: RAG002
    title: "LlamaIndex query engine without access controls"
    severity: high
    pattern: '\.as_query_engine\(\)'
    file_types: ["*.py"]
    suppress_if: ['metadata_filter', 'filters', 'user_id', 'doc_ids', 'node_postprocessor']
    owasp_llm: "LLM06"
    remediation: "Add metadata filters or node postprocessors to enforce document-level ACLs."
    description: "Query engine created without document-level access control."
    analyzer: "RAGACLAnalyzer"

  - id: SI002
    title: "LlamaIndex chat memory without user scoping"
    severity: high
    pattern: 'ChatMemoryBuffer\.from_defaults'
    file_types: ["*.py"]
    suppress_if: ['user_id', 'session_id', 'tenant', 'chat_store_key']
    owasp_llm: "LLM06"
    remediation: "Scope memory per user with chat_store_key parameter."
    description: "Chat memory buffer may be shared across users without proper isolation."
    analyzer: "SessionIsolationAnalyzer"
